# SolarLLM - 太阳能领域智能助手

## 项目概述

SolarLLM是一个基于大语言模型的太阳能领域智能助手，结合先进的人工智能和太阳能电池模拟技术，为太阳能行业的专业人士和研究人员提供精准的技术支持和知识服务。系统核心功能包括：专业知识问答、太阳能电池参数预测、性能优化仿真和数据可视化分析。

【图1：SolarLLM系统架构图 - 展示前端、后端、AI模型和太阳能模拟引擎的交互关系】

## 核心技术实现

### 1. 大语言模型与知识检索系统

#### 模型架构
- 核心语言引擎：DeepSeek大语言模型
- 知识检索引擎：基于文本嵌入技术的相似度搜索系统
- 模型调用接口：OpenAI兼容接口，支持流式响应

#### 嵌入向量技术
- 嵌入模型：BAAI/bge-base-en-v1.5
- 文档处理流程：文本分块→向量化→存储→相似度检索
- 检索增强系统工作流程：
  1. 将用户问题转化为向量表示
  2. 在向量数据库中检索相似文档
  3. 将检索结果作为上下文提供给大语言模型
  4. 生成准确且针对太阳能领域的回答

【图2：知识检索增强系统工作流程图 - 详细展示向量化、相似度检索和上下文注入的技术细节】

### 2. 太阳能电池模拟预测系统

#### 机器学习模型架构
- 框架：AutoGluon自动机器学习框架
- 模型类型：TabularPredictor集成模型
- 训练数据：太阳能电池参数与性能指标配对数据
- 预测目标：Vm、Im、Voc、Jsc、FF、Eff六项关键性能参数

#### 参数预测技术实现
- 输入参数处理：
  - 硅片厚度(Si_thk)
  - 二氧化硅厚度(t_SiO2)
  - 多晶硅厚度(t_polySi_rear_P)
  - 前结/后结参数(front_junc/rear_junc)
  - 掺杂浓度(Nd_top, Nd_rear, Nt_polySi_top, Nt_polySi_rear)
  - 界面态密度(Dit Si-SiOx, Dit SiOx-Poly, Dit top)
- 模型训练与优化：集成多种算法，包括梯度提升树、神经网络，自动调参最大化预测精度
- 部署实现：独立模型分别预测不同参数，提高特化性能

【图3：太阳能电池参数预测流程图 - 展示从输入参数到性能预测的技术路径】

#### JV曲线生成技术
- 基于预测的关键参数自动生成JV特性曲线
- 曲线算法：采用单二极管模型，根据Voc、Jsc动态计算电流-电压关系
- 可视化技术：使用Matplotlib生成高质量曲线图，标注最大功率点(MPP)

【图4：JV曲线示例及计算原理 - 展示系统生成的J-V曲线和计算方式】

### 3. MCP协议与服务架构

#### MCP协议详解
- MCP全称：Model-Controller-Processor架构
- 工作原理：将AI模型、控制逻辑和数据处理解耦，实现模块化设计
- 协议特点：
  1. 服务器-客户端架构，支持SSE(Server-Sent Events)通信
  2. 工具注册与调用机制，使AI能调用专业工具
  3. 异步通信设计，提高系统响应能力

#### MCP服务器实现
- FastMCP框架：核心服务封装，提供工具注册与调用API
- SSE传输层：基于Starlette实现，支持长连接和实时数据推送
- 工具管理系统：
  - `@mcp.tool()`装饰器注册工具
  - 上下文管理(Context)对象提供工具执行状态跟踪
  - 异步执行支持，避免长时间运算阻塞主线程

#### MCP客户端实现
- 客户端会话(ClientSession)：管理与服务器的连接状态
- 异步上下文管理：使用AsyncExitStack保证资源正确释放
- 工具调用流程：
  1. 连接建立与初始化(connect, initialize)
  2. 工具列表获取(list_tools)
  3. 工具参数准备与调用(call_tool)
  4. 结果处理与错误处理

【图5：MCP协议通信流程图 - 详细展示客户端与服务器交互过程和数据流】

### 4. 前后端架构与实现

#### 前端技术栈
- 框架：React 18 + TypeScript
- UI组件：Ant Design
- 构建工具：Vite
- 关键实现：
  - 实时对话界面：流式响应处理与渲染
  - 可视化组件：动态图表展示
  - 参数控制面板：直观调整模拟参数

#### 后端技术栈
- Web框架：FastAPI
- 异步处理：asyncio
- API设计：
  - `/api/chat/send`：处理对话请求
  - `/api/files/{file_path}`：提供生成文件访问
  - 流式响应实现：StreamingResponse

#### 系统集成
- 嵌入向量加载与处理：在服务启动时预加载
- 模型服务集成：通过OpenAI兼容接口连接DeepSeek API
- 数据流处理：采用生成器模式实现流式传输
- 文件系统：组织模拟结果和图表文件

【图6：系统数据流程图 - 展示数据在各组件间的流动和处理路径】

### 5. 高级图表与数据可视化系统

#### 曲线绘制工具
- 实现：`draw_curve`工具支持自定义参数配置
- 功能：动态绘制各类曲线，如JV曲线、参数关系图等
- 技术：Matplotlib生成图像，转换为流式数据传输

#### 表格可视化工具
- 实现：`draw_table`工具支持复杂数据表展示
- 功能：呈现预测结果比较、参数敏感性分析等表格数据
- 格式转换：表格数据自动转换为可视化图像

#### 图像处理技术
- 图像序列化：使用io.BytesIO流处理
- 格式转换：Fig对象转MCP Image对象
- 前端渲染：动态加载和展示生成的图表

【图7：可视化系统架构图 - 展示从数据到图表的生成流程】

## 技术特色与创新点

### 1. 融合先进AI与太阳能专业领域模型
- 将通用大语言模型与专业太阳能电池模拟模型结合
- 通过MCP协议实现异构模型的无缝集成
- 支持多类型模型协同工作，各司其职

### 2. 高效的知识检索与理解系统
- 向量化存储专业文档，提供精准匹配
- 实时检索相关信息，增强AI回答的专业性
- 支持文档更新和知识库扩展

### 3. 参数优化与仿真技术
- 高精度预测模型，快速评估设计方案
- 参数敏感性分析，识别关键影响因素
- 批量仿真能力，支持大规模设计空间探索

【图8：技术创新点展示图 - 直观展示系统的技术创新与优势】

## 系统扩展性设计

### 模型扩展能力
- 支持不同太阳能电池类型的模型接入
- 提供标准化接口，便于添加新的预测模型
- 支持模型切换与参数配置

### 工具扩展机制
- 基于MCP协议的工具注册系统
- 简单的装饰器API实现新工具快速接入
- 工具上下文设计，支持执行状态跟踪

### 知识库更新机制
- 文本处理与向量化流程
- 增量更新支持，无需重建整个知识库
- 文档质量评估和筛选机制

【图9：系统扩展架构图 - 展示系统的可扩展性设计】

## 技术实现挑战与解决方案

### 1. 大模型与专业知识融合问题
- 挑战：通用大模型对专业领域知识掌握不足
- 解决方案：文本嵌入与检索增强，将专业知识注入对话过程

### 2. 模型预测性能与效率平衡
- 挑战：高精度模型通常计算成本高
- 解决方案：模型分解策略，针对不同参数使用专用模型

### 3. 实时交互与计算密集型任务协调
- 挑战：模拟计算可能导致系统响应延迟
- 解决方案：异步处理和任务队列，保证界面响应流畅

【图10：技术挑战与解决方案示意图 - 展示面临的技术难点及应对策略】 