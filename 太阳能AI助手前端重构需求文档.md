# 太阳能AI助手前端重构需求文档

## 项目概述

太阳能AI助手是一个基于Gradio实现的Web平台，旨在提供太阳能电池相关的AI对话、参数预测、老化预测、钙钛矿参数与带隙预测等功能。本文档旨在指导前端重构工作，确保新的前端界面美观、易用，同时保留原有的全部功能。

## 整体架构

项目基于前后端分离架构，前端通过API与后端进行交互。

### 技术栈与依赖

当前实现基于：
- Gradio框架
- Python后端
- RESTful API

重构可考虑使用更现代的前端技术栈，但需确保与现有后端API兼容。

### 文件结构

当前项目结构：
```
web/
├── app.py                # 入口文件，组装和启动所有Tab
├── config.py             # 全局配置（如API_BASE_URL）
├── utils/                # 工具函数
├── api/                  # 各功能Tab的后端API交互与业务逻辑
│   ├── chat.py           # AI对话API逻辑
│   ├── solar.py          # 太阳能参数预测API逻辑
│   ├── aging.py          # 老化预测API逻辑
│   ├── perovskite.py     # 钙钛矿参数预测API逻辑
│   └── bandgap.py        # 钙钛矿带隙预测API逻辑
└── ui/                   # 各功能Tab的UI与事件绑定
    ├── chat.py           # AI对话Tab UI
    ├── solar.py          # 太阳能参数预测Tab UI
    ├── aging.py          # 老化预测Tab UI
    ├── perovskite.py     # 钙钛矿参数预测Tab UI
    └── bandgap.py        # 钙钛矿带隙预测Tab UI
```

## 功能模块需求

### 1. 通用界面要求

- **导航栏**：顶部应有清晰的导航栏，易于切换不同功能模块
- **响应式设计**：支持不同尺寸的设备（桌面、平板、手机）
- **主题**：采用蓝色为主色调的专业科研风格
- **加载状态**：所有需要等待的操作都应有明确的加载指示器
- **错误处理**：友好的错误提示，便于用户理解问题所在
- **一致性**：所有模块在视觉设计和交互模式上保持一致

### 2. AI对话模块

#### 功能需求

- **对话界面**：支持多轮对话，显示用户和AI的交流历史
- **模型选择**：提供下拉菜单选择不同的AI模型
- **对话管理**：
  - 新建对话功能
  - 历史对话加载功能
  - 刷新对话列表功能
- **实时响应**：支持流式响应，逐字输出AI回复
- **渲染支持**：支持Markdown格式渲染
- **状态显示**：显示当前对话状态和模型状态

#### 交互设计

- 左侧为主对话区域，占据约75%空间
- 右侧为控制面板，包含模型选择和历史对话管理
- 底部为输入框和发送按钮
- 支持按Enter键发送消息
- 支持对话内容的复制功能
- 支持图像显示（AI可能输出图像）

#### API接口

- `/chat/create`：创建新对话
- `/chat/send`：发送消息并获取回复（支持SSE流式响应）
- `/chat/history`：获取历史对话列表
- `/models`：获取可用模型列表

### 3. 硅电池参数预测模块

#### 功能需求

- **参数输入**：通过滑块调整多个太阳能电池参数
- **实时预测**：参数变化时自动进行预测（带防抖动）
- **结果展示**：
  - 显示JV曲线图
  - 显示预测结果文本
- **参数分组**：将相关参数进行逻辑分组，便于理解和操作

#### 参数列表

**基础结构参数：**
- Si 厚度 (μm)
- SiO2 厚度 (nm)
- 后表面 PolySi 厚度 (μm)
- 前表面结深度 (μm)
- 后表面结深度 (μm)
- 后表面电阻 (Ω·cm)

**掺杂与界面参数：**
- 前表面掺杂浓度 (cm^-3)
- 后表面掺杂浓度 (cm^-3)
- 前表面 PolySi 掺杂浓度 (cm^-3)
- 后表面 PolySi 掺杂浓度 (cm^-3)
- Si-SiOx 界面缺陷密度 (cm^-2)
- SiOx-Poly 界面缺陷密度 (cm^-2)
- 顶部界面缺陷密度 (cm^-2)

#### 交互设计

- 左侧为参数控制区，分为两列，便于调整
- 右侧上方为JV曲线图显示区
- 右侧下方为预测结果文本区
- 所有科学计数法的参数值应有专门的显示方式，便于阅读
- 滑块调整时实时显示当前值

#### API接口

- `/solar/default-params`：获取默认参数
- `/solar/predict`：提交参数获取预测结果

### 4. 钙钛矿电池老化预测模块

#### 功能需求

- **参数输入**：通过滑块调整大量钙钛矿电池老化相关参数
- **预测触发**：通过按钮触发预测过程
- **结果展示**：
  - 显示老化曲线图
  - 显示预测结果文本

#### 参数列表（简化版，实际参数超过70个）：

主要参数类别包括：
- 电池架构参数
- 基底材料参数
- ETL（电子传输层）参数
- 钙钛矿材料参数（成分、结构、工艺等）
- HTL（空穴传输层）参数
- 背接触参数
- 封装参数
- 稳定性测试参数

#### 交互设计

- 参数过多，应采用折叠面板或者Tab分组方式组织
- 左侧为老化曲线图显示区
- 右侧为预测结果文本区
- 底部为参数调整区和预测按钮
- 考虑添加参数预设功能，方便快速选择常用配置
- 考虑添加参数导入/导出功能

#### API接口

- `/perovskite/default-aging-params`：获取默认老化参数
- `/perovskite/predict-aging`：提交参数获取老化预测结果

### 5. 钙钛矿电池参数预测模块

#### 功能需求

- **参数输入**：通过滑块调整钙钛矿电池各层的物理参数
- **类型选择**：选择窄带隙或宽带隙模型
- **实时预测**：参数变化时自动进行预测（带防抖动）
- **结果展示**：
  - 显示JV曲线图
  - 显示预测结果文本

#### 参数列表

参数分为以下几类：
- HTL（空穴传输层）参数：介电常数、电子亲和能、带隙等
- ETL（电子传输层）参数：介电常数、电子亲和能、带隙等
- 钙钛矿层参数：介电常数、电子亲和能、带隙等
- 各层厚度参数
- 掺杂浓度参数
- 缺陷密度参数

#### 交互设计

- 顶部为模型类型选择
- 左侧为JV曲线图显示区
- 右侧为预测结果文本区
- 底部为可折叠的参数调整区，分为两列
- 科学计数法参数应有专门的显示方式

#### API接口

- `/perovskite/default-params`：获取默认参数
- `/perovskite/predict`：提交参数获取预测结果

### 6. 钙钛矿带隙预测模块

#### 功能需求

- **类型选择**：提供下拉菜单选择不同钙钛矿类型（MAPbIBr、CsMAFAPbIBr、MAFA、CsFA）
- **组分输入**：根据所选类型显示不同的组分比例滑块
- **预测触发**：通过按钮触发预测过程
- **结果展示**：显示预测的带隙值

#### 交互设计

- 左侧为钙钛矿类型选择和组分比例调整区
- 右侧为预测按钮和结果显示区
- 根据所选类型动态显示/隐藏相关组分输入控件
- 可考虑添加带隙值与颜色的可视化展示

#### API接口

- `/perovskite/predict-bandgap`：提交参数获取带隙预测结果

## 非功能需求

### 1. 性能要求

- 页面加载时间：初始加载应在3秒内完成
- 响应时间：用户交互响应应在200ms内完成
- 预测响应：除特别说明外，预测结果应在5秒内返回
- 流畅性：滑块调整等交互应无卡顿感

### 2. 兼容性要求

- 浏览器：支持最新版Chrome、Firefox、Safari、Edge
- 设备：支持桌面电脑、平板电脑、移动设备
- 分辨率：支持最小1280x720到4K分辨率

### 3. 用户体验要求

- 界面美观：专业、科学的视觉设计
- 易用性：直观的操作流程，减少学习成本
- 反馈性：所有操作都有及时的视觉反馈
- 帮助信息：关键参数应有悬停提示解释其含义

### 4. 安全性要求

- 输入验证：防止非法输入导致系统错误
- 错误处理：优雅处理API请求失败等异常情况

## API规范

所有API调用基于以下基础URL：
```
API_BASE_URL = 从config.py获取
```

请求和响应格式均为JSON，具体接口参数和返回值见各功能模块描述。

## 交付物

1. 完整的前端源代码
2. 开发文档，包括：
   - 技术栈说明
   - 项目结构说明
   - 开发环境配置指南
   - API接口使用说明
3. 用户使用手册
4. 部署文档

## 优先级和阶段划分

建议按以下优先级进行开发：

1. **高优先级**（第一阶段）：
   - 整体框架搭建
   - AI对话模块
   - 硅电池参数预测模块

2. **中优先级**（第二阶段）：
   - 钙钛矿参数预测模块
   - 钙钛矿带隙预测模块

3. **低优先级**（第三阶段）：
   - 老化预测模块（参数众多，复杂度高）
   - 性能优化和UI美化

## 注意事项与建议

1. 保持与现有后端API的兼容性
2. 优先实现核心功能，再考虑界面美化
3. 参考业内类似工具的界面设计，如MaterialsProject、MolGAN等
4. 考虑使用组件化开发，提高代码复用性
5. 建议实现参数配置的保存和加载功能
6. 考虑添加简单的用户认证机制
7. 科学数据的可视化建议使用专业图表库，如D3.js、Plotly.js等 