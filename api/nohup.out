/home/gqh/code/project/solarllm/api/main.py:217: DeprecationWarning: 
        on_event is deprecated, use lifespan event handlers instead.

        Read more about it in the
        [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
        
  @app.on_event("startup")
/home/gqh/code/project/solarllm/api/main.py:241: DeprecationWarning: 
        on_event is deprecated, use lifespan event handlers instead.

        Read more about it in the
        [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
        
  @app.on_event("shutdown")
INFO:__main__:正在启动服务器...
--- Logging error ---
Traceback (most recent call last):
  File "/home/gqh/miniconda3/envs/solarllm/lib/python3.10/logging/__init__.py", line 1100, in emit
    msg = self.format(record)
  File "/home/gqh/miniconda3/envs/solarllm/lib/python3.10/logging/__init__.py", line 943, in format
    return fmt.format(record)
  File "/home/gqh/miniconda3/envs/solarllm/lib/python3.10/logging/__init__.py", line 678, in format
    record.message = record.getMessage()
  File "/home/gqh/miniconda3/envs/solarllm/lib/python3.10/logging/__init__.py", line 368, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/gqh/code/project/solarllm/api/main.py", line 974, in <module>
    logger.info("API 密钥:", os.getenv("DEEPSEEK_API_KEY")[:5] + "..." if os.getenv("DEEPSEEK_API_KEY") else "未设置")
Message: 'API 密钥:'
Arguments: ('sk-25...',)
INFO:__main__:MCP服务器地址: http://localhost:12346/sse
INFO:     Started server process [3999982]
INFO:     Waiting for application startup.
INFO:mcp.client.sse:Connecting to SSE endpoint: http://localhost:12346/sse
INFO:httpx:HTTP Request: GET http://localhost:12346/sse "HTTP/1.1 200 OK"
INFO:mcp.client.sse:Received endpoint URL: http://localhost:12346/messages/?session_id=2747379848224b4d8efb9336ba276c82
INFO:mcp.client.sse:Starting post writer with endpoint URL: http://localhost:12346/messages/?session_id=2747379848224b4d8efb9336ba276c82
INFO:httpx:HTTP Request: POST http://localhost:12346/messages/?session_id=2747379848224b4d8efb9336ba276c82 "HTTP/1.1 202 Accepted"
INFO:httpx:HTTP Request: POST http://localhost:12346/messages/?session_id=2747379848224b4d8efb9336ba276c82 "HTTP/1.1 202 Accepted"
INFO:httpx:HTTP Request: POST http://localhost:12346/messages/?session_id=2747379848224b4d8efb9336ba276c82 "HTTP/1.1 202 Accepted"
INFO:__main__:已连接到MCP服务器，可用工具: ['draw_curve', 'draw_table', 'simulate_solar_cell', 'batch_simulate_solar_cell', 'search_embedded_text', 'process_directory_for_embedding']
INFO:__main__:成功连接到MCP服务器: http://localhost:12346/sse
INFO:httpx:HTTP Request: POST http://localhost:12346/messages/?session_id=2747379848224b4d8efb9336ba276c82 "HTTP/1.1 202 Accepted"
INFO:__main__:可用工具: ['draw_curve', 'draw_table', 'simulate_solar_cell', 'batch_simulate_solar_cell', 'search_embedded_text', 'process_directory_for_embedding']
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     127.0.0.1:51198 - "GET /api/models HTTP/1.1" 200 OK
INFO:     127.0.0.1:51210 - "GET /api/chat/history HTTP/1.1" 200 OK
INFO:     127.0.0.1:51222 - "GET /api/solar/default-params HTTP/1.1" 200 OK
INFO:     127.0.0.1:51228 - "GET /api/aging/default-params HTTP/1.1" 200 OK
INFO:__main__:开始老化曲线预测
/home/gqh/code/project/solarllm/api/main.py:934: PydanticDeprecatedSince20: The `dict` method is deprecated; use `model_dump` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.10/migration/
  input_params = params.dict()
INFO:__main__:老化曲线预测完成，图表保存至: plot_results/aging_curve_20250329_172249.png
INFO:     127.0.0.1:51234 - "POST /api/aging/predict HTTP/1.1" 200 OK
INFO:     127.0.0.1:51236 - "POST /api/solar/predict HTTP/1.1" 200 OK
INFO:     127.0.0.1:46516 - "POST /api/chat/create HTTP/1.1" 200 OK
INFO:__main__:处理聊天请求: 模型=deepseek-chat, 会话ID=625d2f10-1a73-4698-84ca-6ed95974213e
INFO:__main__:消息内容: 帮我仿真一下太阳能电池，硅厚度160微米
INFO:     127.0.0.1:46532 - "POST /api/chat/send HTTP/1.1" 200 OK
INFO:__main__:开始处理请求，模型: deepseek-chat
INFO:httpx:HTTP Request: POST http://localhost:12346/messages/?session_id=2747379848224b4d8efb9336ba276c82 "HTTP/1.1 202 Accepted"
INFO:__main__:为模型提供了 6 个可用工具
INFO:httpx:HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
INFO:__main__:模型请求调用工具: simulate_solar_cell，参数: {'Si_thk': 160}
INFO:httpx:HTTP Request: POST http://localhost:12346/messages/?session_id=2747379848224b4d8efb9336ba276c82 "HTTP/1.1 202 Accepted"
INFO:__main__:工具 simulate_solar_cell 返回结果: meta=None content=[TextContent(type='text', text='{"text": {"parameters": {"Vm": 0.5085140466690063, "Im": 37.07712936401367, "Voc": 0.6663550734519958, "Jsc": 39.1009635925293, "FF": 67.07703399658203, "Eff": 20.356298446655273}, "file_path": "simulation_results/jv_curve_20250329_172314_484614.png"}}', annotations=None)] isError=False
INFO:__main__:解析工具返回内容: {"text": {"parameters": {"Vm": 0.5085140466690063, "Im": 37.07712936401367, "Voc": 0.6663550734519958, "Jsc": 39.1009635925293, "FF": 67.07703399658203, "Eff": 20.356298446655273}, "file_path": "simulation_results/jv_curve_20250329_172314_484614.png"}}...
INFO:__main__:发送工具 simulate_solar_cell 的图像路径数据 #0，文件路径: simulation_results/jv_curve_20250329_172314_484614.png
INFO:__main__:工具 simulate_solar_cell 调用成功
INFO:httpx:HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
INFO:__main__:请求处理完成，模型: deepseek-chat
INFO:__main__:完整回答内容长度: 352 字符
INFO:__main__:客户端断开连接，会话ID=625d2f10-1a73-4698-84ca-6ed95974213e
INFO:     127.0.0.1:37306 - "GET /api/files/simulation_results/jv_curve_20250329_172314_484614.png HTTP/1.1" 200 OK
INFO:     10.10.20.62:35956 - "GET /api/models HTTP/1.1" 200 OK
INFO:     10.10.20.62:35968 - "GET /api/chat/history HTTP/1.1" 200 OK
INFO:     10.10.20.62:35984 - "GET /api/solar/default-params HTTP/1.1" 200 OK
INFO:     10.10.20.62:33804 - "GET /api/aging/default-params HTTP/1.1" 200 OK
INFO:     10.10.20.62:33812 - "POST /api/solar/predict HTTP/1.1" 200 OK
INFO:__main__:开始老化曲线预测
/home/gqh/code/project/solarllm/api/main.py:934: PydanticDeprecatedSince20: The `dict` method is deprecated; use `model_dump` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.10/migration/
  input_params = params.dict()
INFO:__main__:老化曲线预测完成，图表保存至: plot_results/aging_curve_20250329_172628.png
INFO:     10.10.20.62:33814 - "POST /api/aging/predict HTTP/1.1" 200 OK
INFO:__main__:开始老化曲线预测
/home/gqh/code/project/solarllm/api/main.py:934: PydanticDeprecatedSince20: The `dict` method is deprecated; use `model_dump` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.10/migration/
  input_params = params.dict()
INFO:__main__:老化曲线预测完成，图表保存至: plot_results/aging_curve_20250329_172650.png
INFO:     10.10.20.62:44172 - "POST /api/aging/predict HTTP/1.1" 200 OK
INFO:     10.10.20.62:44180 - "POST /api/solar/predict HTTP/1.1" 200 OK
INFO:     10.10.20.62:35774 - "POST /api/chat/create HTTP/1.1" 200 OK
INFO:__main__:处理聊天请求: 模型=deepseek-chat, 会话ID=c193d29e-382e-4309-a3b7-fb110b242956
INFO:__main__:消息内容: 你好，帮我仿真一下太阳能电池，厚度为160微米
INFO:     10.10.20.62:35790 - "POST /api/chat/send HTTP/1.1" 200 OK
INFO:__main__:开始处理请求，模型: deepseek-chat
INFO:httpx:HTTP Request: POST http://localhost:12346/messages/?session_id=2747379848224b4d8efb9336ba276c82 "HTTP/1.1 202 Accepted"
INFO:__main__:为模型提供了 6 个可用工具
INFO:httpx:HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
INFO:__main__:模型请求调用工具: simulate_solar_cell，参数: {'Si_thk': 160}
INFO:httpx:HTTP Request: POST http://localhost:12346/messages/?session_id=2747379848224b4d8efb9336ba276c82 "HTTP/1.1 202 Accepted"
INFO:__main__:工具 simulate_solar_cell 返回结果: meta=None content=[TextContent(type='text', text='{"text": {"parameters": {"Vm": 0.5085140466690063, "Im": 37.07712936401367, "Voc": 0.6663550734519958, "Jsc": 39.1009635925293, "FF": 67.07703399658203, "Eff": 20.356298446655273}, "file_path": "simulation_results/jv_curve_20250329_172712_748558.png"}}', annotations=None)] isError=False
INFO:__main__:解析工具返回内容: {"text": {"parameters": {"Vm": 0.5085140466690063, "Im": 37.07712936401367, "Voc": 0.6663550734519958, "Jsc": 39.1009635925293, "FF": 67.07703399658203, "Eff": 20.356298446655273}, "file_path": "simulation_results/jv_curve_20250329_172712_748558.png"}}...
INFO:__main__:发送工具 simulate_solar_cell 的图像路径数据 #0，文件路径: simulation_results/jv_curve_20250329_172712_748558.png
INFO:__main__:工具 simulate_solar_cell 调用成功
INFO:httpx:HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
INFO:__main__:请求处理完成，模型: deepseek-chat
INFO:__main__:完整回答内容长度: 304 字符
INFO:__main__:客户端断开连接，会话ID=c193d29e-382e-4309-a3b7-fb110b242956
INFO:     10.40.24.38:50785 - "GET /api/files/simulation_results/jv_curve_20250329_172712_748558.png HTTP/1.1" 200 OK
INFO:     10.10.20.62:42656 - "GET /api/models HTTP/1.1" 200 OK
INFO:     10.10.20.62:42672 - "GET /api/chat/history HTTP/1.1" 200 OK
INFO:     10.10.20.62:42682 - "GET /api/solar/default-params HTTP/1.1" 200 OK
INFO:     10.10.20.62:42684 - "GET /api/aging/default-params HTTP/1.1" 200 OK
INFO:     10.10.20.62:55110 - "POST /api/solar/predict HTTP/1.1" 200 OK
INFO:__main__:开始老化曲线预测
/home/gqh/code/project/solarllm/api/main.py:934: PydanticDeprecatedSince20: The `dict` method is deprecated; use `model_dump` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.10/migration/
  input_params = params.dict()
INFO:__main__:老化曲线预测完成，图表保存至: plot_results/aging_curve_20250329_172814.png
INFO:     10.10.20.62:55124 - "POST /api/aging/predict HTTP/1.1" 200 OK
INFO:     10.10.20.62:55126 - "POST /api/chat/create HTTP/1.1" 200 OK
INFO:__main__:处理聊天请求: 模型=deepseek-chat, 会话ID=53fa65b3-a488-4579-8daa-0d5b7a9bf2d8
INFO:__main__:消息内容: 你好，帮我仿真一下太阳能电池，厚度为160微米
INFO:     10.10.20.62:43706 - "POST /api/chat/send HTTP/1.1" 200 OK
INFO:__main__:开始处理请求，模型: deepseek-chat
INFO:httpx:HTTP Request: POST http://localhost:12346/messages/?session_id=2747379848224b4d8efb9336ba276c82 "HTTP/1.1 202 Accepted"
INFO:__main__:为模型提供了 6 个可用工具
INFO:httpx:HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
INFO:__main__:模型请求调用工具: simulate_solar_cell，参数: {'Si_thk': 160}
INFO:httpx:HTTP Request: POST http://localhost:12346/messages/?session_id=2747379848224b4d8efb9336ba276c82 "HTTP/1.1 202 Accepted"
INFO:__main__:工具 simulate_solar_cell 返回结果: meta=None content=[TextContent(type='text', text='{"text": {"parameters": {"Vm": 0.5085140466690063, "Im": 37.07712936401367, "Voc": 0.6663550734519958, "Jsc": 39.1009635925293, "FF": 67.07703399658203, "Eff": 20.356298446655273}, "file_path": "simulation_results/jv_curve_20250329_172829_626449.png"}}', annotations=None)] isError=False
INFO:__main__:解析工具返回内容: {"text": {"parameters": {"Vm": 0.5085140466690063, "Im": 37.07712936401367, "Voc": 0.6663550734519958, "Jsc": 39.1009635925293, "FF": 67.07703399658203, "Eff": 20.356298446655273}, "file_path": "simulation_results/jv_curve_20250329_172829_626449.png"}}...
INFO:__main__:发送工具 simulate_solar_cell 的图像路径数据 #0，文件路径: simulation_results/jv_curve_20250329_172829_626449.png
INFO:__main__:工具 simulate_solar_cell 调用成功
INFO:httpx:HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
INFO:__main__:请求处理完成，模型: deepseek-chat
INFO:__main__:完整回答内容长度: 305 字符
INFO:__main__:客户端断开连接，会话ID=53fa65b3-a488-4579-8daa-0d5b7a9bf2d8
INFO:     10.40.24.38:50856 - "GET /api/files/simulation_results/jv_curve_20250329_172829_626449.png HTTP/1.1" 200 OK
INFO:     127.0.0.1:46604 - "GET /api/health HTTP/1.1" 200 OK
INFO:     10.10.20.62:45592 - "GET /api/models HTTP/1.1" 200 OK
INFO:     10.10.20.62:45602 - "GET /api/chat/history HTTP/1.1" 200 OK
INFO:     10.10.20.62:45604 - "GET /api/solar/default-params HTTP/1.1" 200 OK
INFO:     10.10.20.62:45608 - "GET /api/aging/default-params HTTP/1.1" 200 OK
INFO:     10.10.20.62:51720 - "GET /api/models HTTP/1.1" 200 OK
INFO:     10.10.20.62:51730 - "GET /api/chat/history HTTP/1.1" 200 OK
INFO:     10.10.20.62:51742 - "GET /api/solar/default-params HTTP/1.1" 200 OK
INFO:     10.10.20.62:51756 - "GET /api/aging/default-params HTTP/1.1" 200 OK
INFO:__main__:开始老化曲线预测
/home/gqh/code/project/solarllm/api/main.py:934: PydanticDeprecatedSince20: The `dict` method is deprecated; use `model_dump` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.10/migration/
  input_params = params.dict()
INFO:__main__:老化曲线预测完成，图表保存至: plot_results/aging_curve_20250329_173153.png
INFO:     10.10.20.62:54772 - "POST /api/aging/predict HTTP/1.1" 200 OK
INFO:     10.10.20.62:54784 - "POST /api/solar/predict HTTP/1.1" 200 OK
INFO:     10.10.20.62:34684 - "POST /api/chat/create HTTP/1.1" 200 OK
INFO:__main__:处理聊天请求: 模型=deepseek-chat, 会话ID=a159dfad-1528-4160-b40b-ca2dc44458de
INFO:__main__:消息内容: 我之前的问题是什么
INFO:     10.10.20.62:34696 - "POST /api/chat/send HTTP/1.1" 200 OK
INFO:__main__:开始处理请求，模型: deepseek-chat
INFO:httpx:HTTP Request: POST http://localhost:12346/messages/?session_id=2747379848224b4d8efb9336ba276c82 "HTTP/1.1 202 Accepted"
INFO:__main__:为模型提供了 6 个可用工具
INFO:httpx:HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
INFO:__main__:请求处理完成，模型: deepseek-chat
INFO:__main__:完整回答内容长度: 57 字符
INFO:__main__:客户端断开连接，会话ID=a159dfad-1528-4160-b40b-ca2dc44458de
INFO:__main__:处理聊天请求: 模型=deepseek-chat, 会话ID=a159dfad-1528-4160-b40b-ca2dc44458de
INFO:__main__:消息内容: 我之前的问题是什么
INFO:     10.10.20.62:47204 - "POST /api/chat/send HTTP/1.1" 200 OK
INFO:__main__:开始处理请求，模型: deepseek-chat
INFO:httpx:HTTP Request: POST http://localhost:12346/messages/?session_id=2747379848224b4d8efb9336ba276c82 "HTTP/1.1 202 Accepted"
INFO:__main__:为模型提供了 6 个可用工具
INFO:httpx:HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
INFO:__main__:请求处理完成，模型: deepseek-chat
INFO:__main__:完整回答内容长度: 58 字符
INFO:__main__:客户端断开连接，会话ID=a159dfad-1528-4160-b40b-ca2dc44458de
INFO:__main__:处理聊天请求: 模型=deepseek-chat, 会话ID=a159dfad-1528-4160-b40b-ca2dc44458de
INFO:__main__:消息内容: 我的一句话是什么
INFO:     10.10.20.62:39028 - "POST /api/chat/send HTTP/1.1" 200 OK
INFO:__main__:开始处理请求，模型: deepseek-chat
INFO:httpx:HTTP Request: POST http://localhost:12346/messages/?session_id=2747379848224b4d8efb9336ba276c82 "HTTP/1.1 202 Accepted"
INFO:__main__:为模型提供了 6 个可用工具
INFO:httpx:HTTP Request: POST https://api.deepseek.com/chat/completions "HTTP/1.1 200 OK"
INFO:__main__:请求处理完成，模型: deepseek-chat
INFO:__main__:完整回答内容长度: 27 字符
INFO:__main__:客户端断开连接，会话ID=a159dfad-1528-4160-b40b-ca2dc44458de
